<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin ‚Äì Cia de Condimentos e Especiarias</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root {
  --amarelo: #F5C518;
  --amarelo-escuro: #D4A017;
  --vermelho: #C0392B;
  --vermelho-escuro: #922B21;
  --creme: #FFF8E7;
  --marrom: #3E2723;
  --sidebar-w: 260px;
  --bg: #1a1a1a;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Lato', sans-serif; background: #f4f0ea; color: #333; display: flex; min-height: 100vh; }

/* SIDEBAR */
.sidebar {
  width: var(--sidebar-w);
  background: var(--marrom);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  z-index: 100;
  box-shadow: 4px 0 20px rgba(0,0,0,0.3);
}
.sidebar-logo {
  padding: 28px 24px;
  border-bottom: 1px solid rgba(245,197,24,0.15);
}
.sidebar-logo .icon { height: 50px; width: auto; object-fit: contain; display: block; margin-bottom: 8px; border-radius: 8px; }
.sidebar-logo h1 { font-family: 'Playfair Display', serif; font-size: 17px; font-weight: 900; color: var(--amarelo); line-height: 1.2; }
.sidebar-logo p { font-size: 10px; color: rgba(255,255,255,0.4); letter-spacing: 3px; text-transform: uppercase; margin-top: 4px; }
.sidebar-badge { background: var(--vermelho); color: white; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 10px; margin-left: auto; }

.nav-label { font-size: 10px; font-weight: 700; color: rgba(255,255,255,0.3); letter-spacing: 3px; text-transform: uppercase; padding: 20px 24px 8px; }
.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 24px;
  color: rgba(255,255,255,0.65);
  cursor: pointer;
  border-left: 3px solid transparent;
  transition: all 0.2s;
  font-size: 14px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.nav-item:hover { color: white; background: rgba(255,255,255,0.05); }
.nav-item.active { color: var(--amarelo); border-left-color: var(--amarelo); background: rgba(245,197,24,0.07); }
.nav-item .nav-icon { font-size: 18px; width: 24px; text-align: center; }
.sidebar-bottom { margin-top: auto; padding: 20px 24px; border-top: 1px solid rgba(255,255,255,0.08); }
.store-link { display: flex; align-items: center; gap: 8px; color: rgba(255,255,255,0.5); font-size: 12px; cursor: pointer; transition: color 0.2s; }
.store-link:hover { color: var(--amarelo); }

/* MAIN */
.main { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }
.topbar {
  background: white;
  padding: 16px 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid #e8e0d4;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}
.topbar h2 { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 700; color: var(--marrom); }
.topbar-right { display: flex; align-items: center; gap: 16px; }
.topbar-badge { background: var(--amarelo); color: var(--marrom); padding: 4px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; letter-spacing: 1px; }
.admin-avatar { width: 38px; height: 38px; background: var(--vermelho); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 900; font-size: 15px; }
.refresh-btn { background: var(--amarelo); border: none; padding: 8px 16px; border-radius: 4px; font-size: 12px; font-weight: 700; cursor: pointer; color: var(--marrom); letter-spacing: 1px; transition: background 0.2s; }
.refresh-btn:hover { background: var(--amarelo-escuro); }

.content { padding: 32px; flex: 1; }
.page { display: none; }
.page.active { display: block; }

/* DASHBOARD */
.stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }
.stat-card { background: white; border-radius: 10px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border-left: 5px solid transparent; transition: transform 0.2s; }
.stat-card:hover { transform: translateY(-3px); }
.stat-card.red { border-left-color: var(--vermelho); }
.stat-card.yellow { border-left-color: var(--amarelo); }
.stat-card.green { border-left-color: #27ae60; }
.stat-card.orange { border-left-color: #e67e22; }
.stat-icon { font-size: 32px; margin-bottom: 12px; }
.stat-value { font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 900; color: var(--marrom); }
.stat-label { font-size: 12px; color: #999; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }

.dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
.card { background: white; border-radius: 10px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
.card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.card-title { font-family: 'Playfair Display', serif; font-size: 18px; font-weight: 700; color: var(--marrom); }
.period-tabs { display: flex; gap: 4px; }
.period-tab { background: #f4f0ea; border: none; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; cursor: pointer; transition: all 0.2s; color: #888; }
.period-tab.active { background: var(--vermelho); color: white; }

.chart-container { position: relative; height: 200px; }
.bar-chart { display: flex; align-items: flex-end; gap: 8px; height: 180px; padding-top: 10px; }
.bar-group { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 6px; }
.bar { width: 100%; border-radius: 4px 4px 0 0; transition: height 0.5s ease; min-height: 2px; position: relative; cursor: pointer; }
.bar:hover::after { content: attr(data-value); position: absolute; top: -28px; left: 50%; transform: translateX(-50%); background: var(--marrom); color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; white-space: nowrap; }
.bar-label { font-size: 10px; color: #aaa; font-weight: 700; text-transform: uppercase; }

.recent-orders { }
.order-row { display: flex; align-items: center; gap: 16px; padding: 14px 0; border-bottom: 1px solid #f4f0ea; }
.order-row:last-child { border-bottom: none; }
.order-id { font-weight: 900; font-size: 12px; color: var(--marrom); width: 120px; }
.order-customer { flex: 1; font-size: 13px; color: #666; }
.order-total { font-weight: 700; font-size: 14px; color: var(--vermelho); width: 80px; text-align: right; }
.status-pill { padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap; }
.s-pendente { background: #fff3cd; color: #856404; }
.s-processando { background: #d1ecf1; color: #0c5460; }
.s-enviado { background: #d4edda; color: #155724; }
.s-entregue { background: #c8f7c5; color: #1a6617; }
.s-cancelado { background: #f8d7da; color: #721c24; }
.ps-aguardando { background: #fff3cd; color: #856404; }
.ps-pago { background: #d4edda; color: #155724; }
.ps-estornado { background: #f8d7da; color: #721c24; }

/* TABLE */
.table-toolbar { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
.search-box { flex: 1; max-width: 320px; position: relative; }
.search-box input { width: 100%; padding: 10px 16px 10px 40px; border: 2px solid #e8e0d4; border-radius: 4px; font-size: 14px; outline: none; transition: border-color 0.2s; }
.search-box input:focus { border-color: var(--amarelo); }
.search-box::before { content: 'üîç'; position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 16px; }
.btn { padding: 10px 24px; border: none; border-radius: 4px; font-weight: 700; font-size: 13px; cursor: pointer; transition: all 0.2s; letter-spacing: 1px; text-transform: uppercase; }
.btn-primary { background: var(--vermelho); color: white; }
.btn-primary:hover { background: var(--vermelho-escuro); }
.btn-secondary { background: var(--amarelo); color: var(--marrom); }
.btn-secondary:hover { background: var(--amarelo-escuro); }
.btn-sm { padding: 6px 14px; font-size: 12px; }
.btn-ghost { background: transparent; border: 1px solid #ddd; color: #666; }
.btn-ghost:hover { border-color: var(--vermelho); color: var(--vermelho); background: rgba(192,57,43,0.05); }
.btn-danger { background: #e74c3c; color: white; }
.btn-danger:hover { background: #c0392b; }

table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
th { background: var(--marrom); color: var(--amarelo); padding: 14px 16px; text-align: left; font-size: 11px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; }
td { padding: 14px 16px; border-bottom: 1px solid #f4f0ea; font-size: 13px; color: #555; }
tr:last-child td { border-bottom: none; }
tr:hover td { background: #faf7f2; }
.prod-cell { display: flex; align-items: center; gap: 12px; }
.prod-thumb { width: 44px; height: 44px; border-radius: 6px; background: #f0e8d0; display: flex; align-items: center; justify-content: center; font-size: 22px; overflow: hidden; flex-shrink: 0; }
.prod-thumb img { width: 100%; height: 100%; object-fit: cover; }
.prod-name { font-weight: 700; font-size: 14px; color: var(--marrom); }
.prod-cat { font-size: 11px; color: #aaa; }

/* MODAL */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 500; display: none; align-items: center; justify-content: center; padding: 20px; }
.modal-overlay.open { display: flex; }
.modal { background: white; border-radius: 12px; max-width: 640px; width: 100%; max-height: 90vh; display: flex; flex-direction: column; animation: modalIn 0.25s ease; overflow: hidden; }
@keyframes modalIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.modal-header { background: var(--vermelho); padding: 20px 28px; color: white; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
.modal-header h3 { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; }
.modal-header .close { background: none; border: none; color: white; font-size: 22px; cursor: pointer; }
.modal-body { padding: 28px; overflow-y: auto; flex: 1; }
.modal-footer { padding: 20px 28px; border-top: 1px solid #f0e8d0; display: flex; gap: 12px; justify-content: flex-end; flex-shrink: 0; }

.form-row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
.fg { margin-bottom: 18px; }
.fg label { display: block; font-size: 12px; font-weight: 700; color: var(--marrom); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 6px; }
.fg input, .fg select, .fg textarea { width: 100%; padding: 10px 14px; border: 2px solid #e0d8c8; border-radius: 4px; font-size: 14px; font-family: 'Lato', sans-serif; outline: none; transition: border-color 0.2s; background: white; }
.fg input:focus, .fg select:focus, .fg textarea:focus { border-color: var(--amarelo); }
.fg textarea { resize: vertical; min-height: 80px; }
.fg .hint { font-size: 11px; color: #aaa; margin-top: 4px; }

.order-detail { }
.order-detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.detail-section h4 { font-family: 'Playfair Display', serif; font-size: 15px; font-weight: 700; color: var(--vermelho); margin-bottom: 10px; }
.detail-row { display: flex; justify-content: space-between; font-size: 13px; padding: 4px 0; border-bottom: 1px solid #f4f0ea; }
.detail-row strong { color: var(--marrom); }
.order-items-table { width: 100%; margin: 16px 0; }
.order-items-table th { background: #f4f0ea; color: #666; font-size: 11px; padding: 8px 12px; }
.order-items-table td { padding: 10px 12px; border-bottom: 1px solid #f8f4ee; }
.control-group { display: flex; gap: 12px; align-items: center; margin-top: 20px; background: var(--creme); padding: 16px; border-radius: 8px; }
.control-group label { font-size: 12px; font-weight: 700; color: var(--marrom); text-transform: uppercase; letter-spacing: 1px; white-space: nowrap; }
.control-group select { padding: 8px 12px; border: 2px solid #e0d8c8; border-radius: 4px; font-size: 13px; font-weight: 700; outline: none; cursor: pointer; }

.toast { position: fixed; bottom: 30px; right: 30px; background: var(--marrom); color: white; padding: 14px 24px; border-radius: 8px; font-weight: 700; font-size: 14px; z-index: 9999; transform: translateY(100px); opacity: 0; transition: all 0.3s; box-shadow: 0 8px 24px rgba(0,0,0,0.3); max-width: 360px; }
.toast.show { transform: translateY(0); opacity: 1; }

.empty-state { text-align: center; padding: 60px 20px; color: #aaa; }
.empty-state .icon { font-size: 60px; display: block; margin-bottom: 16px; }

.tag { display: inline-block; padding: 2px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; }
.tag-active { background: #d4edda; color: #155724; }
.tag-inactive { background: #f8d7da; color: #721c24; }
.tag-low { background: #fff3cd; color: #856404; }
.tag-out { background: #f8d7da; color: #721c24; }

.actions-cell { display: flex; gap: 6px; }

.confirm-dialog { max-width: 400px; }
.confirm-dialog .modal-body { text-align: center; padding: 40px 28px; }
.confirm-dialog .icon { font-size: 60px; display: block; margin-bottom: 16px; }
.confirm-dialog h4 { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; margin-bottom: 10px; color: var(--marrom); }
.confirm-dialog p { color: #888; font-size: 14px; }

@media (max-width: 1024px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
</style>
</head>
<body>

<div id="toast" class="toast"></div>

<!-- MODALS -->
<div class="modal-overlay" id="productModal">
  <div class="modal">
    <div class="modal-header">
      <h3 id="productModalTitle">Adicionar Produto</h3>
      <button class="close" onclick="closeProductModal()">‚úï</button>
    </div>
    <div class="modal-body" id="productModalBody"></div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeProductModal()">Cancelar</button>
      <button class="btn btn-primary" onclick="saveProduct()">üíæ Salvar Produto</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="orderModal">
  <div class="modal">
    <div class="modal-header">
      <h3 id="orderModalTitle">Detalhes do Pedido</h3>
      <button class="close" onclick="closeOrderModal()">‚úï</button>
    </div>
    <div class="modal-body" id="orderModalBody"></div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeOrderModal()">Fechar</button>
      <button class="btn btn-primary" onclick="saveOrderStatus()">üíæ Salvar Altera√ß√µes</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="confirmModal">
  <div class="modal confirm-dialog">
    <div class="modal-header">
      <h3>Confirma√ß√£o</h3>
      <button class="close" onclick="closeConfirm()">‚úï</button>
    </div>
    <div class="modal-body">
      <span class="icon">‚ö†Ô∏è</span>
      <h4 id="confirmTitle">Tem certeza?</h4>
      <p id="confirmMsg">Esta a√ß√£o n√£o pode ser desfeita.</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeConfirm()">Cancelar</button>
      <button class="btn btn-danger" id="confirmAction">Confirmar</button>
    </div>
  </div>
</div>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <img src="img/logotipooficialciadecondimentos.png" alt="Logo Cia de Condimentos" class="icon">
    <h1>Cia de Condimentos</h1>
    <p>Painel Administrativo</p>
  </div>
  <div class="nav-label">Menu</div>
  <div class="nav-item active" onclick="showPage('dashboard', this)">
    <span class="nav-icon">üìä</span> Dashboard
  </div>
  <div class="nav-item" onclick="showPage('products', this)">
    <span class="nav-icon">üå∂Ô∏è</span> Produtos
    <span class="sidebar-badge" id="prodCount">0</span>
  </div>
  <div class="nav-item" onclick="showPage('orders', this)">
    <span class="nav-icon">üì¶</span> Pedidos
    <span class="sidebar-badge" id="ordersCount">0</span>
  </div>
  <div class="nav-item" onclick="showPage('reports', this)">
    <span class="nav-icon">üìà</span> Relat√≥rios
  </div>
  <div class="sidebar-bottom">
    <div class="store-link" onclick="window.open('loja.html','_blank')">
      üîó Acessar Loja do Cliente
    </div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <h2 id="pageTitle">Dashboard</h2>
    <div class="topbar-right">
      <span class="topbar-badge">üü¢ Sistema Online</span>
      <button class="refresh-btn" onclick="reloadAll()">‚Üª Atualizar</button>
      <div class="admin-avatar">A</div>
    </div>
  </div>

  <div class="content">

    <!-- DASHBOARD -->
    <div class="page active" id="page-dashboard">
      <div class="stats-grid">
        <div class="stat-card red">
          <div class="stat-icon">üì¶</div>
          <div class="stat-value" id="dash-orders">0</div>
          <div class="stat-label">Total de Pedidos</div>
        </div>
        <div class="stat-card yellow">
          <div class="stat-icon">üå∂Ô∏è</div>
          <div class="stat-value" id="dash-products">0</div>
          <div class="stat-label">Produtos Cadastrados</div>
        </div>
        <div class="stat-card green">
          <div class="stat-icon">üí∞</div>
          <div class="stat-value" id="dash-revenue">R$ 0</div>
          <div class="stat-label">Receita Total</div>
        </div>
        <div class="stat-card orange">
          <div class="stat-icon">‚è≥</div>
          <div class="stat-value" id="dash-pending">0</div>
          <div class="stat-label">Pedidos Pendentes</div>
        </div>
      </div>

      <div class="dashboard-grid">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Vendas por Per√≠odo</span>
            <div class="period-tabs">
              <button class="period-tab active" onclick="changePeriod('week', this)">Semana</button>
              <button class="period-tab" onclick="changePeriod('month', this)">M√™s</button>
              <button class="period-tab" onclick="changePeriod('year', this)">Ano</button>
            </div>
          </div>
          <div class="bar-chart" id="salesChart"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">√öltimos Pedidos</span>
            <button class="btn btn-sm btn-secondary" onclick="showPage('orders', document.querySelector('[onclick*=\"orders\"]'))">Ver todos</button>
          </div>
          <div id="recentOrders"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Estoque Cr√≠tico</span>
          </div>
          <div id="lowStockList"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Top Produtos</span>
          </div>
          <div id="topProducts"></div>
        </div>
      </div>
    </div>

    <!-- PRODUCTS -->
    <div class="page" id="page-products">
      <div class="table-toolbar">
        <div class="search-box"><input type="text" placeholder="Buscar produto..." id="prodSearch" oninput="renderProductsTable()"></div>
        <select id="prodCatFilter" onchange="renderProductsTable()" style="padding:10px 14px; border:2px solid #e8e0d4; border-radius:4px; font-size:13px; outline:none; font-family:Lato,sans-serif;">
          <option value="">Todas Categorias</option>
          <option value="Temperos">Temperos</option>
          <option value="Pimentas">Pimentas</option>
          <option value="Ervas">Ervas</option>
          <option value="Molhos">Molhos</option>
          <option value="Especiarias">Especiarias</option>
        </select>
        <button class="btn btn-primary" onclick="openAddProduct()">+ Novo Produto</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Produto</th>
            <th>C√≥digo de Barras</th>
            <th>Categoria</th>
            <th>Pre√ßo</th>
            <th>Estoque</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="productsTableBody"></tbody>
      </table>
    </div>

    <!-- ORDERS -->
    <div class="page" id="page-orders">
      <div class="table-toolbar">
        <div class="search-box"><input type="text" placeholder="Buscar pedido ou cliente..." id="orderSearch" oninput="renderOrdersTable()"></div>
        <select id="orderStatusFilter" onchange="renderOrdersTable()" style="padding:10px 14px; border:2px solid #e8e0d4; border-radius:4px; font-size:13px; outline:none; font-family:Lato,sans-serif;">
          <option value="">Todos os Status</option>
          <option value="Pendente">Pendente</option>
          <option value="Processando">Processando</option>
          <option value="Enviado">Enviado</option>
          <option value="Entregue">Entregue</option>
          <option value="Cancelado">Cancelado</option>
        </select>
      </div>
      <table>
        <thead>
          <tr>
            <th>Pedido</th>
            <th>Cliente</th>
            <th>Data</th>
            <th>Total</th>
            <th>Pagamento</th>
            <th>Status Pgto</th>
            <th>Status Pedido</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="ordersTableBody"></tbody>
      </table>
    </div>

    <!-- REPORTS -->
    <div class="page" id="page-reports">
      <div class="dashboard-grid">
        <div class="card" style="grid-column:1/-1">
          <div class="card-header">
            <span class="card-title">Relat√≥rio de Vendas</span>
            <div class="period-tabs">
              <button class="period-tab active" onclick="changeReportPeriod('7', this)">7 dias</button>
              <button class="period-tab" onclick="changeReportPeriod('30', this)">30 dias</button>
              <button class="period-tab" onclick="changeReportPeriod('90', this)">90 dias</button>
            </div>
          </div>
          <div id="reportStats" style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin:20px 0;"></div>
          <div class="bar-chart" id="reportChart" style="height:200px;"></div>
        </div>

        <div class="card">
          <div class="card-header"><span class="card-title">Vendas por Categoria</span></div>
          <div id="categoryReport"></div>
        </div>

        <div class="card">
          <div class="card-header"><span class="card-title">Formas de Pagamento</span></div>
          <div id="paymentReport"></div>
        </div>
      </div>
    </div>

  </div>
</main>

<script>
const STORAGE_KEYS = { products: 'cia_products', orders: 'cia_orders' };

function getProducts() { const s = localStorage.getItem(STORAGE_KEYS.products); return s ? JSON.parse(s) : []; }
function saveProducts(p) { localStorage.setItem(STORAGE_KEYS.products, JSON.stringify(p)); }
function getOrders() { const s = localStorage.getItem(STORAGE_KEYS.orders); return s ? JSON.parse(s) : []; }
function saveOrders(o) { localStorage.setItem(STORAGE_KEYS.orders, JSON.stringify(o)); }

function fmt(v) { return 'R$ ' + Number(v).toFixed(2).replace('.', ','); }
function fmtDate(iso) { const d = new Date(iso); return d.toLocaleDateString('pt-BR') + ' ' + d.toLocaleTimeString('pt-BR', {hour:'2-digit',minute:'2-digit'}); }
function catEmoji(c) { return {'Pimentas':'üå∂Ô∏è','Especiarias':'‚ú®','Ervas':'üåø','Temperos':'üßÇ','Molhos':'ü´ô'}[c] || 'üå∂Ô∏è'; }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3500);
}

function showPage(page, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  if (el) el.classList.add('active');
  const titles = { dashboard: 'Dashboard', products: 'Produtos', orders: 'Pedidos', reports: 'Relat√≥rios' };
  document.getElementById('pageTitle').textContent = titles[page] || page;
  if (page === 'dashboard') renderDashboard();
  else if (page === 'products') renderProductsTable();
  else if (page === 'orders') renderOrdersTable();
  else if (page === 'reports') renderReports('7');
}

function reloadAll() {
  const activePage = document.querySelector('.page.active').id.replace('page-', '');
  showPage(activePage);
  updateSidebarCounts();
  showToast('‚úÖ Dados atualizados!');
}

function updateSidebarCounts() {
  const products = getProducts();
  const orders = getOrders();
  document.getElementById('prodCount').textContent = products.filter(p => p.active).length;
  document.getElementById('ordersCount').textContent = orders.filter(o => o.status === 'Pendente').length;
}

// ===== DASHBOARD =====
let currentPeriod = 'week';

function renderDashboard() {
  const orders = getOrders();
  const products = getProducts();
  const revenue = orders.reduce((s, o) => s + (o.total || 0), 0);
  const pending = orders.filter(o => o.status === 'Pendente').length;

  document.getElementById('dash-orders').textContent = orders.length;
  document.getElementById('dash-products').textContent = products.length;
  document.getElementById('dash-revenue').textContent = 'R$ ' + Math.round(revenue);
  document.getElementById('dash-pending').textContent = pending;

  renderSalesChart(currentPeriod);
  renderRecentOrders(orders.slice(0, 5));
  renderLowStock(products);
  renderTopProducts(orders, products);
  updateSidebarCounts();
}

function changePeriod(period, btn) {
  currentPeriod = period;
  document.querySelectorAll('.period-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderSalesChart(period);
}

function renderSalesChart(period) {
  const orders = getOrders();
  const chart = document.getElementById('salesChart');
  let labels = [], days = 0;

  if (period === 'week') { labels = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b']; days = 7; }
  else if (period === 'month') { labels = ['S1','S2','S3','S4']; days = 30; }
  else { labels = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez']; days = 365; }

  const data = labels.map((_, i) => {
    const now = new Date();
    let filtered;
    if (period === 'week') {
      const dayStart = new Date(now); dayStart.setDate(now.getDate() - (6 - i));
      filtered = orders.filter(o => { const d = new Date(o.createdAt); return d.toDateString() === dayStart.toDateString(); });
    } else if (period === 'month') {
      filtered = orders.filter(o => { const d = new Date(o.createdAt); const weeksAgo = Math.floor((now - d) / (7*24*3600*1000)); return weeksAgo === (labels.length - 1 - i); });
    } else {
      filtered = orders.filter(o => new Date(o.createdAt).getMonth() === i);
    }
    return filtered.reduce((s, o) => s + (o.total || 0), 0);
  });

  const maxVal = Math.max(...data, 1);
  const colors = ['var(--vermelho)', 'var(--amarelo)', '#e67e22', '#27ae60', '#3498db', '#9b59b6', '#1abc9c'];

  chart.innerHTML = data.map((val, i) => `
    <div class="bar-group">
      <div class="bar" style="height:${(val/maxVal)*160}px; background:${colors[i % colors.length]}; max-width:40px;" data-value="${fmt(val)}"></div>
      <span class="bar-label">${labels[i]}</span>
    </div>
  `).join('');
}

function renderRecentOrders(orders) {
  const el = document.getElementById('recentOrders');
  if (orders.length === 0) { el.innerHTML = '<div class="empty-state"><span class="icon">üì¶</span><p>Nenhum pedido ainda</p></div>'; return; }
  el.innerHTML = orders.map(o => `
    <div class="order-row">
      <div class="order-id">${o.id.slice(0, 16)}</div>
      <div class="order-customer">${o.customer?.name || 'N/A'}</div>
      <div class="order-total">${fmt(o.total)}</div>
      <span class="status-pill s-${o.status?.toLowerCase()}">${o.status}</span>
    </div>
  `).join('');
}

function renderLowStock(products) {
  const low = products.filter(p => p.stock <= 10).sort((a, b) => a.stock - b.stock).slice(0, 5);
  const el = document.getElementById('lowStockList');
  if (low.length === 0) { el.innerHTML = '<p style="color:#aaa;text-align:center;padding:20px">‚úÖ Todos os estoques est√£o OK</p>'; return; }
  el.innerHTML = low.map(p => `
    <div class="order-row">
      <div class="prod-thumb">${p.image ? '<img src="'+p.image+'" onerror="this.parentElement.innerHTML=\''+catEmoji(p.category)+'\'">' : catEmoji(p.category)}</div>
      <div style="flex:1;margin-left:10px">
        <div style="font-weight:700;font-size:13px">${p.name}</div>
        <div style="font-size:11px;color:#aaa">${p.category}</div>
      </div>
      <span class="status-pill ${p.stock===0?'s-cancelado':'s-pendente'}">${p.stock===0?'Esgotado':p.stock+' un.'}</span>
    </div>
  `).join('');
}

function renderTopProducts(orders, products) {
  const counts = {};
  orders.forEach(o => (o.items || []).forEach(i => { counts[i.id] = (counts[i.id] || 0) + i.qty; }));
  const top = Object.entries(counts).sort((a,b) => b[1]-a[1]).slice(0, 5).map(([id, qty]) => {
    const p = products.find(x => x.id == id);
    return p ? { ...p, soldQty: qty } : null;
  }).filter(Boolean);

  const el = document.getElementById('topProducts');
  if (top.length === 0) { el.innerHTML = '<p style="color:#aaa;text-align:center;padding:20px">Sem dados de vendas</p>'; return; }
  el.innerHTML = top.map((p, i) => `
    <div class="order-row">
      <span style="font-size:18px;width:24px">${['ü•á','ü•à','ü•â','4Ô∏è‚É£','5Ô∏è‚É£'][i]}</span>
      <div style="flex:1">
        <div style="font-weight:700;font-size:13px">${p.name}</div>
        <div style="font-size:11px;color:#aaa">${p.category}</div>
      </div>
      <span style="font-weight:700;color:var(--vermelho)">${p.soldQty} vendidos</span>
    </div>
  `).join('');
}

// ===== PRODUCTS TABLE =====
function renderProductsTable() {
  const search = document.getElementById('prodSearch').value.toLowerCase();
  const catFilter = document.getElementById('prodCatFilter').value;
  let products = getProducts();
  if (search) products = products.filter(p => p.name.toLowerCase().includes(search) || (p.barcode || '').includes(search));
  if (catFilter) products = products.filter(p => p.category === catFilter);

  const tbody = document.getElementById('productsTableBody');
  if (products.length === 0) { tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><span class="icon">üå∂Ô∏è</span><p>Nenhum produto encontrado</p></div></td></tr>'; return; }

  tbody.innerHTML = products.map(p => {
    const stockClass = p.stock === 0 ? 'tag-out' : p.stock <= 5 ? 'tag-low' : 'tag-active';
    const stockLabel = p.stock === 0 ? '‚õî Esgotado' : p.stock <= 5 ? '‚ö†Ô∏è Baixo' : '‚úÖ OK';
    return `<tr>
      <td><div class="prod-cell">
        <div class="prod-thumb">${p.image ? '<img src="'+p.image+'" alt="" onerror="this.parentElement.innerHTML=\''+catEmoji(p.category)+'\'">' : catEmoji(p.category)}</div>
        <div><div class="prod-name">${p.name}</div><div class="prod-cat">${p.weight||''} ${p.origin?'¬∑ '+p.origin:''}</div></div>
      </div></td>
      <td><span style="font-family:monospace;font-size:12px;color:#888">${p.barcode || '‚Äî'}</span></td>
      <td><span class="tag tag-active">${p.category}</span></td>
      <td><strong>${fmt(p.price)}</strong></td>
      <td><span class="tag ${stockClass}">${p.stock} un. ${stockLabel}</span></td>
      <td><span class="tag ${p.active ? 'tag-active' : 'tag-inactive'}">${p.active ? 'Ativo' : 'Inativo'}</span></td>
      <td><div class="actions-cell">
        <button class="btn btn-sm btn-secondary" onclick="openEditProduct(${p.id})">‚úèÔ∏è Editar</button>
        <button class="btn btn-sm btn-ghost" onclick="toggleProductActive(${p.id})">${p.active ? 'üî¥ Desativar' : 'üü¢ Ativar'}</button>
        <button class="btn btn-sm btn-danger" onclick="confirmDelete(${p.id})">üóëÔ∏è</button>
      </div></td>
    </tr>`;
  }).join('');
}

// ===== PRODUCT MODAL =====
let editingProductId = null;

function openAddProduct() {
  editingProductId = null;
  document.getElementById('productModalTitle').textContent = '+ Adicionar Produto';
  document.getElementById('productModalBody').innerHTML = productForm({});
  document.getElementById('productModal').classList.add('open');
}

function openEditProduct(id) {
  editingProductId = id;
  const p = getProducts().find(x => x.id === id);
  if (!p) return;
  document.getElementById('productModalTitle').textContent = '‚úèÔ∏è Editar Produto';
  document.getElementById('productModalBody').innerHTML = productForm(p);
  document.getElementById('productModal').classList.add('open');
}

function productForm(p) {
  return `
    <div class="fg"><label>Nome do Produto *</label><input type="text" id="pName" value="${p.name||''}" placeholder="Ex: Pimenta do Reino Preta"></div>
    <div class="form-row-2">
      <div class="fg"><label>Categoria *</label>
        <select id="pCat">
          ${['Temperos','Pimentas','Ervas','Molhos','Especiarias'].map(c => `<option value="${c}" ${p.category===c?'selected':''}>${c}</option>`).join('')}
        </select>
      </div>
      <div class="fg"><label>Pre√ßo (R$) *</label><input type="number" id="pPrice" value="${p.price||''}" min="0" step="0.01" placeholder="0,00"></div>
    </div>
    <div class="form-row-3">
      <div class="fg"><label>Estoque *</label><input type="number" id="pStock" value="${p.stock||0}" min="0" placeholder="0"></div>
      <div class="fg"><label>Peso / Volume</label><input type="text" id="pWeight" value="${p.weight||''}" placeholder="Ex: 100g"></div>
      <div class="fg"><label>Origem</label><input type="text" id="pOrigin" value="${p.origin||''}" placeholder="Ex: Brasil"></div>
    </div>
    <div class="form-row-2">
      <div class="fg"><label>C√≥digo de Barras</label><input type="text" id="pBarcode" value="${p.barcode||''}" placeholder="0000000000000"></div>
      <div class="fg"><label>SKU / Refer√™ncia</label><input type="text" id="pSku" value="${p.sku||''}" placeholder="SKU-001"></div>
    </div>
    <div class="fg"><label>URL da Imagem</label><input type="url" id="pImage" value="${p.image||''}" placeholder="https://exemplo.com/imagem.jpg" oninput="previewImage(this.value)">
      <div class="hint">Cole a URL da imagem do produto</div>
      <div id="imgPreview" style="margin-top:10px">${p.image ? '<img src="'+p.image+'" style="width:100px;height:100px;object-fit:cover;border-radius:8px;border:2px solid #e0d8c8">' : ''}</div>
    </div>
    <div class="fg"><label>Descri√ß√£o</label><textarea id="pDesc" placeholder="Descri√ß√£o do produto...">${p.description||''}</textarea></div>
    <div class="form-row-2">
      <div class="fg"><label>Marca</label><input type="text" id="pBrand" value="${p.brand||''}" placeholder="Nome da marca"></div>
      <div class="fg"><label>Validade (meses)</label><input type="number" id="pExpiry" value="${p.expiry||''}" min="1" placeholder="Ex: 24"></div>
    </div>
    <div class="fg"><label>Status</label>
      <select id="pActive"><option value="true" ${p.active!==false?'selected':''}>Ativo</option><option value="false" ${p.active===false?'selected':''}>Inativo</option></select>
    </div>
  `;
}

function previewImage(url) {
  const el = document.getElementById('imgPreview');
  el.innerHTML = url ? '<img src="'+url+'" style="width:100px;height:100px;object-fit:cover;border-radius:8px;border:2px solid #e0d8c8" onerror="this.remove()">' : '';
}

function saveProduct() {
  const name = document.getElementById('pName').value.trim();
  const price = parseFloat(document.getElementById('pPrice').value);
  const stock = parseInt(document.getElementById('pStock').value);

  if (!name || isNaN(price) || isNaN(stock)) { showToast('‚ö†Ô∏è Preencha Nome, Pre√ßo e Estoque!'); return; }

  const data = {
    name, price, stock, active: document.getElementById('pActive').value === 'true',
    category: document.getElementById('pCat').value,
    weight: document.getElementById('pWeight').value.trim(),
    origin: document.getElementById('pOrigin').value.trim(),
    barcode: document.getElementById('pBarcode').value.trim(),
    sku: document.getElementById('pSku').value.trim(),
    image: document.getElementById('pImage').value.trim(),
    description: document.getElementById('pDesc').value.trim(),
    brand: document.getElementById('pBrand').value.trim(),
    expiry: document.getElementById('pExpiry').value.trim(),
  };

  const products = getProducts();
  if (editingProductId) {
    const idx = products.findIndex(p => p.id === editingProductId);
    if (idx !== -1) products[idx] = { ...products[idx], ...data };
    showToast('‚úÖ Produto atualizado com sucesso!');
  } else {
    const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
    products.push({ id: newId, ...data });
    showToast('‚úÖ Produto adicionado com sucesso!');
  }
  saveProducts(products);
  closeProductModal();
  renderProductsTable();
  updateSidebarCounts();
}

function closeProductModal() { document.getElementById('productModal').classList.remove('open'); }

function toggleProductActive(id) {
  const products = getProducts();
  const p = products.find(x => x.id === id);
  if (p) { p.active = !p.active; saveProducts(products); renderProductsTable(); showToast(p.active ? '‚úÖ Produto ativado!' : 'üî¥ Produto desativado!'); }
}

// ===== CONFIRM DELETE =====
let confirmCallback = null;
function confirmDelete(id) {
  document.getElementById('confirmTitle').textContent = 'Excluir Produto?';
  document.getElementById('confirmMsg').textContent = 'Esta a√ß√£o ir√° remover permanentemente o produto do sistema.';
  document.getElementById('confirmAction').onclick = () => { deleteProduct(id); closeConfirm(); };
  document.getElementById('confirmModal').classList.add('open');
}
function closeConfirm() { document.getElementById('confirmModal').classList.remove('open'); }
function deleteProduct(id) {
  const products = getProducts().filter(p => p.id !== id);
  saveProducts(products); renderProductsTable(); updateSidebarCounts(); showToast('üóëÔ∏è Produto exclu√≠do!');
}

// ===== ORDERS TABLE =====
function renderOrdersTable() {
  const search = document.getElementById('orderSearch').value.toLowerCase();
  const statusFilter = document.getElementById('orderStatusFilter').value;
  let orders = getOrders();
  if (search) orders = orders.filter(o => o.id.toLowerCase().includes(search) || o.customer?.name?.toLowerCase().includes(search) || o.customer?.email?.toLowerCase().includes(search));
  if (statusFilter) orders = orders.filter(o => o.status === statusFilter);

  const tbody = document.getElementById('ordersTableBody');
  if (orders.length === 0) { tbody.innerHTML = '<tr><td colspan="8"><div class="empty-state"><span class="icon">üì¶</span><p>Nenhum pedido encontrado</p></div></td></tr>'; return; }

  tbody.innerHTML = orders.map(o => `
    <tr>
      <td><strong style="font-family:monospace;font-size:12px;color:var(--vermelho)">${o.id}</strong></td>
      <td>
        <div style="font-weight:700;font-size:13px">${o.customer?.name || '‚Äî'}</div>
        <div style="font-size:11px;color:#aaa">${o.customer?.email || ''}</div>
      </td>
      <td style="font-size:12px;color:#888">${fmtDate(o.createdAt)}</td>
      <td><strong>${fmt(o.total)}</strong></td>
      <td><span style="font-size:12px">${o.payment || '‚Äî'}</span></td>
      <td><span class="status-pill ps-${(o.paymentStatus||'aguardando').toLowerCase()}">${o.paymentStatus || 'Aguardando'}</span></td>
      <td><span class="status-pill s-${(o.status||'pendente').toLowerCase()}">${o.status || 'Pendente'}</span></td>
      <td><button class="btn btn-sm btn-secondary" onclick="openOrderModal('${o.id}')">üëÅ Detalhes</button></td>
    </tr>
  `).join('');
}

// ===== ORDER MODAL =====
let editingOrderId = null;

function openOrderModal(id) {
  editingOrderId = id;
  const order = getOrders().find(o => o.id === id);
  if (!order) return;

  document.getElementById('orderModalTitle').textContent = 'üì¶ Pedido ' + id;
  document.getElementById('orderModalBody').innerHTML = `
    <div class="order-detail">
      <div class="order-detail-grid">
        <div class="detail-section">
          <h4>üë§ Dados do Cliente</h4>
          <div class="detail-row"><span>Nome</span><strong>${order.customer?.name||'‚Äî'}</strong></div>
          <div class="detail-row"><span>E-mail</span><strong>${order.customer?.email||'‚Äî'}</strong></div>
          <div class="detail-row"><span>Telefone</span><strong>${order.customer?.phone||'‚Äî'}</strong></div>
          <div class="detail-row"><span>CPF</span><strong>${order.customer?.cpf||'‚Äî'}</strong></div>
          <div class="detail-row"><span>Endere√ßo</span><strong>${order.customer?.address||'‚Äî'}</strong></div>
        </div>
        <div class="detail-section">
          <h4>üí≥ Dados do Pedido</h4>
          <div class="detail-row"><span>Pedido</span><strong>${order.id}</strong></div>
          <div class="detail-row"><span>Data</span><strong>${fmtDate(order.createdAt)}</strong></div>
          <div class="detail-row"><span>Pagamento</span><strong>${order.payment||'‚Äî'}</strong></div>
          <div class="detail-row"><span>Subtotal</span><strong>${fmt(order.subtotal||0)}</strong></div>
          <div class="detail-row"><span>Frete</span><strong>${order.frete===0?'Gr√°tis':fmt(order.frete||0)}</strong></div>
          <div class="detail-row"><span>Total</span><strong style="color:var(--vermelho)">${fmt(order.total||0)}</strong></div>
        </div>
      </div>

      <h4 style="font-family:'Playfair Display',serif;font-size:16px;font-weight:700;color:var(--vermelho);margin-bottom:10px">üõí Itens do Pedido</h4>
      <table class="order-items-table">
        <thead><tr><th>Produto</th><th>Qtd</th><th>Pre√ßo Unit.</th><th>Total</th></tr></thead>
        <tbody>${(order.items||[]).map(i => `
          <tr>
            <td><strong>${i.name}</strong></td>
            <td>${i.qty}</td>
            <td>${fmt(i.price)}</td>
            <td>${fmt(i.price*i.qty)}</td>
          </tr>
        `).join('')}</tbody>
      </table>

      <div class="control-group">
        <label>Status do Pedido:</label>
        <select id="editOrderStatus">
          ${['Pendente','Processando','Enviado','Entregue','Cancelado'].map(s => `<option value="${s}" ${order.status===s?'selected':''}>${s}</option>`).join('')}
        </select>
        <label style="margin-left:20px">Status do Pagamento:</label>
        <select id="editPaymentStatus">
          ${['Aguardando','Pago','Estornado'].map(s => `<option value="${s}" ${order.paymentStatus===s?'selected':''}>${s}</option>`).join('')}
        </select>
      </div>
    </div>
  `;
  document.getElementById('orderModal').classList.add('open');
}

function closeOrderModal() { document.getElementById('orderModal').classList.remove('open'); }

function saveOrderStatus() {
  const orders = getOrders();
  const idx = orders.findIndex(o => o.id === editingOrderId);
  if (idx === -1) return;

  const newStatus = document.getElementById('editOrderStatus').value;
  const newPayment = document.getElementById('editPaymentStatus').value;
  orders[idx].status = newStatus;
  orders[idx].paymentStatus = newPayment;
  orders[idx].updatedAt = new Date().toISOString();

  saveOrders(orders);
  closeOrderModal();
  renderOrdersTable();
  renderDashboard();
  showToast('‚úÖ Pedido atualizado: ' + newStatus + ' / ' + newPayment);
}

// ===== REPORTS =====
let reportDays = '7';

function changeReportPeriod(days, btn) {
  reportDays = days;
  document.querySelectorAll('.period-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderReports(days);
}

function renderReports(days) {
  const orders = getOrders();
  const cutoff = new Date(); cutoff.setDate(cutoff.getDate() - parseInt(days));
  const filtered = orders.filter(o => new Date(o.createdAt) >= cutoff);

  const revenue = filtered.reduce((s, o) => s + (o.total || 0), 0);
  const avgTicket = filtered.length > 0 ? revenue / filtered.length : 0;

  document.getElementById('reportStats').innerHTML = `
    <div class="stat-card red"><div class="stat-icon">üì¶</div><div class="stat-value">${filtered.length}</div><div class="stat-label">Pedidos no per√≠odo</div></div>
    <div class="stat-card green"><div class="stat-icon">üí∞</div><div class="stat-value">R$ ${Math.round(revenue)}</div><div class="stat-label">Receita no per√≠odo</div></div>
    <div class="stat-card yellow"><div class="stat-icon">üéØ</div><div class="stat-value">R$ ${Math.round(avgTicket)}</div><div class="stat-label">Ticket m√©dio</div></div>
  `;

  // Chart: last N days grouped
  const n = parseInt(days);
  const step = n <= 7 ? 1 : n <= 30 ? 7 : 30;
  const groups = Math.ceil(n / step);
  const chartData = Array.from({length: groups}, (_, i) => {
    const end = new Date(); end.setDate(end.getDate() - i * step);
    const start = new Date(end); start.setDate(start.getDate() - step);
    const val = filtered.filter(o => { const d = new Date(o.createdAt); return d >= start && d <= end; }).reduce((s, o) => s + (o.total || 0), 0);
    const label = step === 1 ? end.toLocaleDateString('pt-BR', {weekday:'short'}) : end.toLocaleDateString('pt-BR', {day:'2-digit',month:'short'});
    return { val, label };
  }).reverse();

  const maxVal = Math.max(...chartData.map(d => d.val), 1);
  document.getElementById('reportChart').innerHTML = chartData.map(d => `
    <div class="bar-group">
      <div class="bar" style="height:${(d.val/maxVal)*160}px; background:var(--vermelho); max-width:40px;" data-value="${fmt(d.val)}"></div>
      <span class="bar-label">${d.label}</span>
    </div>
  `).join('');

  // Category breakdown
  const catTotals = {};
  filtered.forEach(o => (o.items||[]).forEach(i => { catTotals[i.category || 'Outros'] = (catTotals[i.category||'Outros']||0) + i.qty; }));
  document.getElementById('categoryReport').innerHTML = Object.entries(catTotals).length === 0 ? '<p style="color:#aaa;text-align:center;padding:20px">Sem dados</p>' :
    Object.entries(catTotals).sort((a,b) => b[1]-a[1]).map(([cat, qty]) => `
      <div class="order-row">
        <span style="font-size:20px">${catEmoji(cat)}</span>
        <div style="flex:1;margin-left:10px"><strong>${cat}</strong></div>
        <span style="font-weight:700;color:var(--vermelho)">${qty} itens</span>
      </div>
    `).join('');

  // Payment breakdown
  const payTotals = {};
  filtered.forEach(o => { payTotals[o.payment||'N√£o informado'] = (payTotals[o.payment||'N√£o informado']||0) + 1; });
  const payIcons = { 'PIX':'üí†','Cart√£o de Cr√©dito':'üí≥','Cart√£o de D√©bito':'üí≥','Boleto':'üè¶','N√£o informado':'‚ùì' };
  document.getElementById('paymentReport').innerHTML = Object.entries(payTotals).length === 0 ? '<p style="color:#aaa;text-align:center;padding:20px">Sem dados</p>' :
    Object.entries(payTotals).sort((a,b) => b[1]-a[1]).map(([method, count]) => `
      <div class="order-row">
        <span style="font-size:20px">${payIcons[method]||'üí≥'}</span>
        <div style="flex:1;margin-left:10px"><strong>${method}</strong></div>
        <span style="font-weight:700;color:var(--vermelho)">${count} pedido${count>1?'s':''}</span>
      </div>
    `).join('');
}

// ===== INIT =====
renderDashboard();
window.addEventListener('storage', () => {
  reloadAll();
});
</script>
</body>
</html>